{% extends "admin/base.html" %}
{% load static %}

{% block branding %}
    {% include "unfold/helpers/site-branding.html" %}
{% endblock %}

{% block subheader %}
    {{ site_subheader }}
{% endblock %}

{% block content %}
<div class="p-4 md:p-6 space-y-6">

    <!-- –í–µ—Ä—Ö–Ω–∏–π –±–ª–æ–∫: –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ -->
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
        <h1 class="text-2xl md:text-3xl font-bold text-gray-900 dark:text-white">
            üìä –ü–∞–Ω–µ–ª—å –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
        </h1>
        <p class="text-gray-500 dark:text-gray-400 text-sm md:text-base">
            –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ request.user.username }} üëã
        </p>
    </div>

    <!-- KPI –∫–∞—Ä—Ç–æ—á–∫–∏ —Å –º–∏–Ω–∏-–≥—Ä–∞—Ñ–∏–∫–∞–º–∏ -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6">
        <!-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ -->
        <div class="bg-gradient-to-br from-indigo-500 to-indigo-600 text-white rounded-xl p-4 shadow hover:opacity-95 transition">
            <div class="flex items-center justify-between">
                <span class="font-semibold text-sm">üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</span>
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M10 12H7a3 3 0 00-3 3v2M10 12h4m-4 0a3 3 0 00-3-3H7m7 3h3a3 3 0 013 3v2m-3-3a3 3 0 00-3-3h-4m-7 3a3 3 0 013-3h4"></path>
                </svg>
            </div>
            <div class="mt-2 text-2xl md:text-3xl font-extrabold">{{ total_users|default:0 }}</div>
            <canvas id="usersChart" class="mt-2 h-10 w-full"></canvas>
        </div>

        <!-- –ü–ª–æ—â–∞–¥–∫–∏ -->
        <div class="bg-gradient-to-br from-emerald-500 to-emerald-600 text-white rounded-xl p-4 shadow hover:opacity-95 transition">
            <div class="flex items-center justify-between">
                <span class="font-semibold text-sm">üèüÔ∏è –ü–ª–æ—â–∞–¥–∫–∏</span>
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                </svg>
            </div>
            <div class="mt-2 text-2xl md:text-3xl font-extrabold">{{ total_venues|default:0 }}</div>
            <canvas id="venuesChart" class="mt-2 h-10 w-full"></canvas>
        </div>

        <!-- –ë—Ä–æ–Ω–∏ -->
        <div class="bg-gradient-to-br from-amber-500 to-orange-600 text-white rounded-xl p-4 shadow hover:opacity-95 transition">
            <div class="flex items-center justify-between">
                <span class="font-semibold text-sm">üìÖ –ë—Ä–æ–Ω–∏</span>
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h8M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                </svg>
            </div>
            <div class="mt-2 text-2xl md:text-3xl font-extrabold">{{ total_bookings|default:0 }}</div>
            <canvas id="bookingsChart" class="mt-2 h-10 w-full"></canvas>
        </div>

        <!-- –î–æ—Ö–æ–¥ -->
        <div class="bg-gradient-to-br from-rose-500 to-pink-600 text-white rounded-xl p-4 shadow hover:opacity-95 transition">
            <div class="flex items-center justify-between">
                <span class="font-semibold text-sm">üí∞ –î–æ—Ö–æ–¥</span>
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V3m0 2v3m0 3.5c0 1.488 2.08 2.599 3 3.5m0 0a1 1 0 01-1 1h-2a1 1 0 01-1-1m0 0c-1.11 0-2.08-.402-2.599-1M12 21v-3m0-2.5a3.5 3.5 0 100-7 3.5 3.5 0 000 7z"></path>
                </svg>
            </div>
            <div class="mt-2 text-2xl md:text-3xl font-extrabold">{{ total_revenue|default:0 }} —Å—É–º</div>
            <canvas id="revenueChart" class="mt-2 h-10 w-full"></canvas>
        </div>
    </div>

    <!-- –¢–∞–±–ª–∏—Ü–∞ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –ø–ª–æ—â–∞–¥–æ–∫ -->
    <div class="overflow-x-auto bg-white dark:bg-gray-800 rounded-xl shadow p-4 md:p-6 mt-6">
        <h2 class="text-lg md:text-2xl font-bold text-gray-900 dark:text-white mb-2">üèÜ –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –ø–ª–æ—â–∞–¥–∫–∏</h2>
        <span class="text-gray-500 dark:text-gray-400 text-sm">–¢–æ–ø-5 –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –±—Ä–æ–Ω–µ–π</span>
        <table class="min-w-full mt-4 text-sm md:text-base">
            <thead class="border-b border-gray-200 dark:border-gray-700 text-left">
                <tr>
                    <th class="px-2 md:px-4 py-2">–ü–ª–æ—â–∞–¥–∫–∞</th>
                    <th class="px-2 md:px-4 py-2 text-right">–ë—Ä–æ–Ω–∏</th>
                </tr>
            </thead>
            <tbody>
                {% for venue in top_venues %}
                <tr class="border-b border-gray-100 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700/30">
                    <td class="px-2 md:px-4 py-2">{{ venue.stadium__name }}</td>
                    <td class="px-2 md:px-4 py-2 text-right font-bold text-indigo-600 dark:text-indigo-400">{{ venue.total }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="2" class="text-center py-4 text-gray-500">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Chart.js –¥–ª—è –º–∏–Ω–∏-–≥—Ä–∞—Ñ–∏–∫–æ–≤ -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // –ü—Ä–∏–º–µ—Ä –ø—Ä–æ—Å—Ç—ã—Ö –º–∏–Ω–∏-–≥—Ä–∞—Ñ–∏–∫–æ–≤ –¥–ª—è KPI (–º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
    const usersChart = new Chart(document.getElementById('usersChart'), {
        type: 'line',
        data: {
            labels: ['–ü–Ω','–í—Ç','–°—Ä','–ß—Ç','–ü—Ç','–°–±','–í—Å'],
            datasets: [{ data: [5,8,6,10,12,7,9], borderColor: '#6366F1', tension: 0.4, fill: false }]
        },
        options: { responsive: true, plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { display: false } } }
    });

    const venuesChart = new Chart(document.getElementById('venuesChart'), {
        type: 'line',
        data: { labels: ['–ü–Ω','–í—Ç','–°—Ä','–ß—Ç','–ü—Ç','–°–±','–í—Å'], datasets: [{ data: [2,3,3,4,5,3,2], borderColor: '#10B981', tension: 0.4, fill: false }] },
        options: { responsive: true, plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { display: false } } }
    });

    const bookingsChart = new Chart(document.getElementById('bookingsChart'), {
        type: 'line',
        data: { labels: ['–ü–Ω','–í—Ç','–°—Ä','–ß—Ç','–ü—Ç','–°–±','–í—Å'], datasets: [{ data: [15,20,18,25,30,22,19], borderColor: '#F59E0B', tension: 0.4, fill: false }] },
        options: { responsive: true, plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { display: false } } }
    });

    const revenueChart = new Chart(document.getElementById('revenueChart'), {
        type: 'line',
        data: { labels: ['–ü–Ω','–í—Ç','–°—Ä','–ß—Ç','–ü—Ç','–°–±','–í—Å'], datasets: [{ data: [5000,8000,6000,12000,15000,9000,11000], borderColor: '#F43F5E', tension: 0.4, fill: false }] },
        options: { responsive: true, plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { display: false } } }
    });
</script>
{% endblock %}
